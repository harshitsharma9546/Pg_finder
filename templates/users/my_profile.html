{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>

/* DARK HEADER BAR - matching dashboard */
.profile-header {
    background: linear-gradient(135deg, #1e1f3d 0%, #2d2e4f 100%);
    color: white;
    padding: 40px 20px;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.profile-header-info {
    display: flex;
    align-items: center;
    gap: 20px;
}

.profile-header-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid white;
}

.profile-header-text h1 {
    margin: 0;
    font-size: 28px;
    font-weight: 700;
}

.profile-header-text p {
    margin: 5px 0 0 0;
    font-size: 14px;
    opacity: 0.9;
}

.profile-header-member {
    font-size: 13px;
    opacity: 0.8;
}

/* OUTER WRAPPER */
.profile-container {
    max-width: 1100px;
    margin: 40px auto;
    padding: 10px;
}

.profile-card {
    background: white;
    padding: 30px;
    border-radius: 14px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

/* TITLES */
.section-title {
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 25px;
}

/* MAIN LAYOUT */
.profile-content {
    display: flex;
    gap: 40px;
}

/* LEFT SECTION */
.left-section {
    width: 30%;
    text-align: center;
}

.image-wrapper {
    margin-bottom: 15px;
}

.profile-img {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #eee;
}

/* NAME + EMAIL */
.username {
    font-size: 20px;
    margin-bottom: 5px;
}

.email {
    color: #777;
    margin-bottom: 20px;
}

/* UPLOAD AREA */
.upload-label {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 5px;
    display: block;
    text-align: left;
}

.upload-input {
    width: 100%;
    border: 1px solid #ccc;
    padding: 6px;
    border-radius: 6px;
    background: #fff;
    margin-bottom: 10px;
}

.upload-btn {
    background: #007bff;
    color: white;
    padding: 7px 20px;
    border-radius: 8px;
    border: none;
    width: 100%;
    cursor: pointer;
    transition: background 0.2s;
}

.upload-btn:hover {
    background: #0056b3;
}

/* RIGHT SECTION */
.right-section {
    width: 70%;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    column-gap: 25px;
    row-gap: 18px;
}

.full {
    grid-column: span 2;
}

/* FORM INPUTS */
.form-group label {
    font-weight: 600;
    margin-bottom: 5px;
    display: block;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 15px;
    background: white;
    color: black;
}

/* BUTTON ROW */
.btn-row {
    margin-top: 25px;
    display: flex;
    gap: 15px;
}

.save-btn {
    background: #28a745;
    color: white;
    padding: 10px 22px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: background 0.2s;
}

.save-btn:hover {
    background: #218838;
}

.cancel-btn {
    padding: 10px 22px;
    border-radius: 8px;
    border: 1px solid gray;
    background: #fff;
    color: black;
    cursor: pointer;
    transition: background 0.2s;
    text-decoration: none;
}

.cancel-btn:hover {
    background: #f5f5f5;
}

.alert-msg{
    background:#d4edda;
    padding:10px;
    border-radius:5px;
    margin-bottom:15px;
}

</style>

<!-- DARK HEADER BAR -->
<div class="profile-header">
    <div class="profile-header-info">
        {% if user_obj.profile_image %}
            <img id="headerAvatar" src="{{ user_obj.profile_image.url }}" alt="Avatar" class="profile-header-avatar">
        {% else %}
            <img id="headerAvatar" src="{% static 'images/user.png' %}" alt="Avatar" class="profile-header-avatar">
        {% endif %}
        <div class="profile-header-text">
            <h1 id="headerName">{{ user_obj.first_name }} {{ user_obj.last_name }}</h1>
            <p id="headerEmail">{{ user_obj.email }}</p>
            <p class="profile-header-member">Member since: {{ user_obj.date_joined|date:"M d, Y" }}</p>
        </div>
    </div>
</div>

<div class="profile-container">
    <div class="profile-card">

        <h2 class="section-title">My Profile</h2>

        {% if messages %}
            {% for message in messages %}
                <div class="alert-msg">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <div class="profile-content">

            <!-- LEFT SIDE -->
            <div class="left-section">
                <div class="image-wrapper">
                    {% if user_obj.profile_image %}
                        <img id="avatarPreview" src="{{ user_obj.profile_image.url }}" class="profile-img">
                    {% else %}
                        <img id="avatarPreview" src="{% static 'images/user.png' %}" class="profile-img">
                    {% endif %}
                </div>

                <h4 class="username">{{ user_obj.first_name }} {{ user_obj.last_name }}</h4>
                <p class="email">{{ user_obj.email }}</p>

                <form method="post" enctype="multipart/form-data" id="imageUploadForm">
                    {% csrf_token %}
                    <label class="upload-label">Change Profile Photo</label>
                    <input type="file" name="profile_image" id="profileImageInput" class="upload-input">

                    <button type="submit" class="upload-btn">Upload Photo</button>
                </form>
            </div>

            <!-- RIGHT SIDE -->
            <div class="right-section">
                <form method="post">
                    {% csrf_token %}

                    <div class="form-grid">

                        <div class="form-group">
                            <label>First Name</label>
                            <input type="text" name="first_name" value="{{ user_obj.first_name }}">
                        </div>

                        <div class="form-group">
                            <label>Last Name</label>
                            <input type="text" name="last_name" value="{{ user_obj.last_name }}">
                        </div>

                        <div class="form-group">
                            <label>Username</label>
                            <input type="text" name="username" value="{{ user_obj.username }}">
                        </div>

                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" value="{{ user_obj.email }}" readonly>
                        </div>

                        <div class="form-group">
                            <label>Phone</label>
                            <input type="text" name="phone" value="{{ user_obj.phone }}">
                        </div>

                        <div class="form-group">
                            <label>Gender</label>
                            <select name="gender">
                                <option value="">Select</option>
                                <option value="male" {% if user_obj.gender == 'male' %}selected{% endif %}>Male</option>
                                <option value="female" {% if user_obj.gender == 'female' %}selected{% endif %}>Female</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" name="date_of_birth" value="{{ user_obj.date_of_birth }}">
                        </div>

                        <div class="form-group">
                            <label>Aadhar</label>
                            <input type="text" value="{{ user_obj.aadhar_card }}" readonly>
                        </div>

                        <div class="form-group full">
                            <label>Address</label>
                            <textarea name="address" rows="2">{{ user_obj.address }}</textarea>
                        </div>

                        <div class="form-group">
                            <label>City</label>
                            <input type="text" name="city" value="{{ user_obj.city }}">
                        </div>

                        <div class="form-group">
                            <label>State</label>
                            <input type="text" name="state" value="{{ user_obj.state }}">
                        </div>

                        <div class="form-group">
                            <label>PIN Code</label>
                            <input type="text" name="pin_code" value="{{ user_obj.pin_code }}">
                        </div>

                    </div>

                    <div class="btn-row">
                        <button type="submit" class="save-btn">Save Changes</button>
                        <a href="{% url 'home' %}" class="cancel-btn">Cancel</a>
                    </div>

                </form>
            </div>
        </div>

    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function () {
    const input = document.getElementById('profileImageInput');
    const preview = document.getElementById('avatarPreview');
    const headerAvatar = document.getElementById('headerAvatar');
    const headerName = document.getElementById('headerName');
    const firstNameInput = document.querySelector('input[name="first_name"]');
    const lastNameInput = document.querySelector('input[name="last_name"]');

    input.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (evt) {
            preview.src = evt.target.result;
            headerAvatar.src = evt.target.result;
            const navImg = document.getElementById('navProfileImg');
            if (navImg) navImg.src = evt.target.result;
        }
        reader.readAsDataURL(file);
    });

    // Update header name in real-time as user types
    if (firstNameInput && lastNameInput) {
        [firstNameInput, lastNameInput].forEach(input => {
            input.addEventListener('input', function() {
                const firstName = firstNameInput.value || 'User';
                const lastName = lastNameInput.value || '';
                headerName.textContent = firstName + (lastName ? ' ' + lastName : '');
            });
        });
    }
});
</script>

{% endblock %}
